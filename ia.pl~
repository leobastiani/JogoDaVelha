% Carrega os arquivos que auxiliaram o jogo
?- ['Matriz'].


% estadoResposta possui dois parametros
% Estado que ?uma matriz 3x3 que dado esse determinado estado, vamos considerar a resposta
% Resposta que ?um vetor com os n?mero de cada casa correspondente

% Exemplo:
% para o estado:
% [
%	[0, 0, X], % posi?es: [0, 1, 2],
%	[0, O, 0], % posi?es: [3, 4, 5],
%	[X, 0, 0]  % posi?es: [6, 7, 8]
% ]
% Resposta ?[1, 3, 5, 7]
:- dynamic estadoResposta/2.



carregarBD :-
	exists_file('JogoDaVelha.bd'),
	consult('JogoDaVelha.bd')
	;
	true.



salvarBD :-
	tell('JogoDaVelha.bd'),
	listing(estadoResposta),
	told.


novoEstado(Matriz) :-
	repeat, % existe um false no caso de nao ser uma lista
	writeln('Por favor, digite um vetor de posicoes possiveis para esse estado.'),
	writeln('Devem ser algo como [1, 3, 5, 6, 7],'),
	writeln('seguindo a matriz a seguir.'),
	matriz3x3PosLinear(ModeloMatriz),
	printMatriz(ModeloMatriz),
	read(Str),
	is_list(Str), % garante que Str eh uma lista
	assertz(estadoResposta(Matriz, Str)),
	!.


% dada uma matriz, devo encontrar a reposta em estadoResposta
encontrarResposta(Matriz, Respostas) :-
	% se ja possuo o estado, sem girar ja retorno ele
	estadoResposta(Matriz, Respostas),
	! % se achei, não procuro mais
	;
	% mas se eu não achei, procuro nas giradas
	encontrarResposta(Matriz, Respostas, 1).

% vou girar e procurar
encontrarResposta(Matriz, Respostas, NumeroGiradas) :-
	matriz3x3GirarH(Matriz, MatrizGirada),
	estadoResposta(MatrizGirada, Respostas),
	!
	; % se ainda não encontrei, então eu giro de novo
	NumeroGiradas =< 3, % vou dar no máximo 3 giradas
	NovoGiradas is NumeroGiradas+1,
	encontrarResposta(MatrizGirada, Respostas, NovoGiradas).


% caso de existir um estadoResposta
iaPlay(Matriz, XouO, NovaMatriz) :-
	encontrarResposta(Matriz, Respostas),
	% posicaoo linear eh algo entre [1, 2, 3, 4, 5, 6, 7, 8, 9]
	random_member(PosLinear, Respostas),
	% converto a posicao para linha e coluna da martiz
	converterPosLinear(PosLinear, IndexLin, IndexCol),
	% substituo o elemento na matriz
	matrizSet(XouO, Matriz, IndexLin, IndexCol, NovaMatriz).


% caso de n? souber onde jogar
iaPlay(Matriz, XouO, NovaMatriz) :-
	novoEstado(Matriz),
	% agora que eu tenho o novo estado, devo jogar nele
	iaPlay(Matriz, XouO, NovaMatriz).
